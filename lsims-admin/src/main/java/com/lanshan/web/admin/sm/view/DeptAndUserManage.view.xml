<?xml version="1.0" encoding="UTF-8"?>
<ViewConfig>
  <Arguments/>
  <Context/>
  <Model>
    <DataType name="dataTypeDept">
      <Property name="creationType">com.lanshan.web.admin.model.SmDept</Property>
      <PropertyDef name="id"/>
      <PropertyDef name="createTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">创建时间</Property>
      </PropertyDef>
      <PropertyDef name="desc">
        <Property name="label">描述</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="label">机构名称</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="parentId">
        <Property name="label">上级机构ID</Property>
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="parentName">
        <Property name="label">上级机构</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="systemId">
        <Property name="label">系统标识</Property>
        <Property name="mapping">
          <Property name="mapValues">${CommonUtils.querySystemListAll()}</Property>
          <Property name="keyProperty">systemId</Property>
          <Property name="valueProperty">desc</Property>
        </Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="enabled">
        <Property name="label">是否禁用</Property>
        <Property name="mapping">
          <Property name="mapValues">
            <Collection>
              <Entity>
                <Property name="key">0</Property>
                <Property name="value">否</Property>
              </Entity>
              <Entity>
                <Property name="key">1</Property>
                <Property name="value">是</Property>
              </Entity>
            </Collection>
          </Property>
        </Property>
      </PropertyDef>
      <PropertyDef name="provinceId">
        <Property name="dataType">Integer</Property>
        <Property name="label">所属省份</Property>
      </PropertyDef>
      <PropertyDef name="cityId">
        <Property name="label">所属市</Property>
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="areaId">
        <Property name="dataType">Integer</Property>
        <Property name="label">所属区</Property>
        <Property name="required">false</Property>
      </PropertyDef>
      <PropertyDef name="areaName">
        <Property name="label">所属区域</Property>
        <Property name="required">false</Property>
      </PropertyDef>
      <PropertyDef name="address">
        <Property name="label">地址</Property>
      </PropertyDef>
      <PropertyDef name="lastUpdatePerson">
        <Property name="label">最后修改人</Property>
      </PropertyDef>
      <PropertyDef name="lastUpdateTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">最后修改时间</Property>
      </PropertyDef>
      <Reference name="children">
        <Property name="dataType">[SELF]</Property>
        <Property name="dataProvider">smDeptCotroller#queryDeptChildren</Property>
        <Property name="parameter">
          <Entity>
            <Property name="parentId">$${this.id}</Property>
          </Entity>
        </Property>
      </Reference>
    </DataType>
    <DataType name="dataTypeDeptQuery">
      <PropertyDef name="name">
        <Property name="label">机构名称</Property>
      </PropertyDef>
    </DataType>
    <DataType name="dataTypeUser">
      <Property name="creationType">com.lanshan.web.admin.model.SmUser</Property>
      <PropertyDef name="id"/>
      <PropertyDef name="username">
        <Property name="label">用户名</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="address">
        <Property name="label">住址</Property>
      </PropertyDef>
      <PropertyDef name="cname">
        <Property name="label">中文名</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="administrator">
        <Property name="label">是否系统管理员</Property>
        <Property name="mapping">
          <Property name="mapValues">
            <Collection>
              <Entity>
                <Property name="key">0</Property>
                <Property name="value">否</Property>
              </Entity>
              <Entity>
                <Property name="key">1</Property>
                <Property name="value">是</Property>
              </Entity>
            </Collection>
          </Property>
        </Property>
      </PropertyDef>
      <PropertyDef name="birthday">
        <Property name="dataType">Date</Property>
        <Property name="label">生日</Property>
      </PropertyDef>
      <PropertyDef name="createDate">
        <Property name="dataType">DateTime</Property>
        <Property name="label">创建时间</Property>
      </PropertyDef>
      <PropertyDef name="email">
        <Property name="label">邮箱</Property>
      </PropertyDef>
      <PropertyDef name="enabled">
        <Property name="label">是否可用</Property>
        <Property name="mapping">
          <Property name="mapValues">
            <Collection>
              <Entity>
                <Property name="key">0</Property>
                <Property name="value">否</Property>
              </Entity>
              <Entity>
                <Property name="key">1</Property>
                <Property name="value">是</Property>
              </Entity>
            </Collection>
          </Property>
        </Property>
        <Property name="defaultValue">1</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="ename">
        <Property name="label">英文名</Property>
      </PropertyDef>
      <PropertyDef name="male">
        <Property name="label">性别</Property>
        <Property name="mapping">
          <Property name="mapValues">
            <Collection>
              <Entity>
                <Property name="key">0</Property>
                <Property name="value">男</Property>
              </Entity>
              <Entity>
                <Property name="key">1</Property>
                <Property name="value">女</Property>
              </Entity>
            </Collection>
          </Property>
        </Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="mobile">
        <Property name="label">手机号码</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="password">
        <Property name="label">密码</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="salt">
        <Property name="label">盐值</Property>
      </PropertyDef>
      <PropertyDef name="lastUpdatePerson">
        <Property name="label">最后修改人</Property>
      </PropertyDef>
      <PropertyDef name="lastUpdateTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">最后修改时间</Property>
      </PropertyDef>
      <PropertyDef name="weixinOpenId">
        <Property name="label">微信openid</Property>
      </PropertyDef>
      <PropertyDef name="dept">
        <Property name="dataType">dataTypeDept</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="oldPassword">
        <Property name="label">原密码</Property>
      </PropertyDef>
      <PropertyDef name="againPassword">
        <Property name="label">确认密码</Property>
      </PropertyDef>
      <PropertyDef name="newPassword">
        <Property name="label">新密码</Property>
      </PropertyDef>
      <PropertyDef name="deptId">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="positionsFullName">
        <Property></Property>
        <Property name="label">岗位</Property>
      </PropertyDef>
      <Reference name="positions">
        <Property name="dataType">[smPosition]</Property>
        <Property name="dataProvider">smPositionCotrller#getSmPositionListByUserId</Property>
        <Property name="parameter">
          <Entity>
            <Property name="userId">$${this.id}</Property>
          </Entity>
        </Property>
      </Reference>
    </DataType>
    <DataType name="dataTypeUserQuery">
      <PropertyDef name="many">
        <Property name="label">账号|中文名|手机</Property>
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="deptName">
        <Property name="label">所属机构</Property>
      </PropertyDef>
      <PropertyDef name="enabled">
        <Property name="label">是否可用</Property>
        <Property name="mapping">
          <Property name="mapValues">
            <Collection>
              <Entity>
                <Property name="key">0</Property>
                <Property name="value">否</Property>
              </Entity>
              <Entity>
                <Property name="key">1</Property>
                <Property name="value">是</Property>
              </Entity>
            </Collection>
          </Property>
        </Property>
        <Property name="defaultValue">1</Property>
      </PropertyDef>
      <PropertyDef name="id">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="username">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="address">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="cname">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="administrator">
        <Property></Property>
        <Property name="label">0：否  1：是</Property>
      </PropertyDef>
      <PropertyDef name="birthday">
        <Property name="dataType">Date</Property>
      </PropertyDef>
      <PropertyDef name="deptId">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="createDate">
        <Property name="dataType">Date</Property>
      </PropertyDef>
      <PropertyDef name="email">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="ename">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="male">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="mobile">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="password">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="salt">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="lastUpdatePerson">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="lastUpdateTime">
        <Property name="dataType">Date</Property>
      </PropertyDef>
      <PropertyDef name="weixinOpenId">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="oldPassword">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="newPassword">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="againPassword">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="positionsFullName">
        <Property></Property>
      </PropertyDef>
    </DataType>
    <DataType name="dataTypeDept2">
      <Property name="creationType">com.lanshan.web.admin.model.SmDept</Property>
      <PropertyDef name="id"/>
      <PropertyDef name="createTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">创建时间</Property>
      </PropertyDef>
      <PropertyDef name="desc">
        <Property name="label">描述</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="label">机构名称</Property>
      </PropertyDef>
      <PropertyDef name="parentId">
        <Property name="label">上级机构ID</Property>
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="systemId">
        <Property name="label">系统标识ID</Property>
      </PropertyDef>
      <PropertyDef name="enabled">
        <Property name="label">是否禁用</Property>
        <Property name="mapping">
          <Property name="mapValues">
            <Collection>
              <Entity>
                <Property name="key">0</Property>
                <Property name="value">否</Property>
              </Entity>
              <Entity>
                <Property name="key">1</Property>
                <Property name="value">是</Property>
              </Entity>
            </Collection>
          </Property>
        </Property>
      </PropertyDef>
      <PropertyDef name="provinceId">
        <Property name="dataType">Integer</Property>
        <Property name="label">所属省份</Property>
      </PropertyDef>
      <PropertyDef name="cityId">
        <Property name="label">所属市</Property>
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="areaId">
        <Property name="dataType">Integer</Property>
        <Property name="label">所属区</Property>
      </PropertyDef>
      <PropertyDef name="address">
        <Property name="label">地址</Property>
      </PropertyDef>
      <PropertyDef name="lastUpdatePerson">
        <Property name="label">最后修改人</Property>
      </PropertyDef>
      <PropertyDef name="lastUpdateTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">最后修改时间</Property>
      </PropertyDef>
      <Reference name="children">
        <Property name="dataType">[SELF]</Property>
        <Property name="dataProvider">smDeptCotroller#loadQueryResult</Property>
        <Property name="parameter">
          <Entity>
            <Property name="parentId">$${this.id}</Property>
          </Entity>
        </Property>
      </Reference>
    </DataType>
    <DataType name="dataTypeDeptAutRange" parent="smDeptAutRange">
      <Reference name="rangeDept">
        <Property name="dataProvider">smDeptCotroller#queryDeptInfoById</Property>
        <Property name="dataType">dataTypeDept</Property>
        <Property name="parameter">$${this.deptId}</Property>
      </Reference>
    </DataType>
    <DataType name="dtDept2">
      <Property name="creationType">com.lanshan.web.admin.model.SmDept</Property>
      <Reference name="parents">
        <Property name="dataProvider">smDeptCotroller#queryDeptParentsById</Property>
        <Property name="dataType">[smDept]</Property>
        <Property name="parameter">$${this.id}</Property>
      </Reference>
      <PropertyDef name="id">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="createTime">
        <Property name="dataType">Date</Property>
      </PropertyDef>
      <PropertyDef name="desc">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="parentId">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="systemId">
        <Property></Property>
        <Property name="label">分布式系统中标识</Property>
      </PropertyDef>
      <PropertyDef name="enabled">
        <Property></Property>
        <Property name="label">0:否 1：是</Property>
      </PropertyDef>
      <PropertyDef name="provinceId">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="cityId">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="areaId">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="address">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="lastUpdatePerson">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="lastUpdateTime">
        <Property name="dataType">Date</Property>
      </PropertyDef>
    </DataType>
    <DataType name="smPosition">
      <Property name="creationType">com.lanshan.web.admin.model.SmPosition</Property>
      <PropertyDef name="id">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="desc">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="code">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="lastUpdatePerson">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="lastUpdateTime">
        <Property name="dataType">Date</Property>
      </PropertyDef>
      <PropertyDef name="systemId">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="createDate">
        <Property name="dataType">Date</Property>
      </PropertyDef>
      <PropertyDef name="rolesFullName">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="selected"/>
    </DataType>
    <DataType name="urlType">
      <Property name="creationType">com.lanshan.web.admin.model.SmUrl</Property>
      <PropertyDef name="id">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="desc">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="icon">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="order">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="parentId">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="systemId">
        <Property></Property>
        <Property name="label">分布式系统中标识这个菜单前缀域名</Property>
      </PropertyDef>
      <PropertyDef name="url">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="code">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="createDate">
        <Property name="dataType">Date</Property>
      </PropertyDef>
    </DataType>
  </Model>
  <View>
    <ClientEvent name="onReady">self.opp = &quot;0&quot;;   //定义操作类型  0:查看  1：新增 2：修改&#xD;
&#xD;
var para = view.id(&quot;dsDept&quot;).get(&quot;dataType&quot;).get(&quot;propertyDefs&quot;).get(&quot;children&quot;).get(&quot;parameter&quot;);&#xD;
if(!para) {&#xD;
	para = {};&#xD;
}&#xD;
para.parentId = &quot;$${this.id}&quot;;&#xD;
view.id(&quot;dsDept&quot;).get(&quot;dataType&quot;).get(&quot;propertyDefs&quot;).get(&quot;children&quot;).set(&quot;parameter&quot;,para);&#xD;
&#xD;
self.deptId = null;&#xD;
self.deptName = null;&#xD;
//机构查询&#xD;
self.query = function(state){&#xD;
	var dsDept = this.id(&quot;dsDept&quot;);	&#xD;
	view.id('dataTreeGridDept').clearNodes();	&#xD;
	&#xD;
	//view.id(&quot;dsDept&quot;).get(&quot;children&quot;).set(&quot;parameter&quot;,{});&#xD;
	dsDept.flushAsync();&#xD;
	&#xD;
	//var entity = this.id(&quot;dsDept&quot;).getData(&quot;#&quot;);&#xD;
	//var record = node.get(&quot;data&quot;);&#xD;
	&#xD;
	//view.init();&#xD;
	&#xD;
};&#xD;
&#xD;
self.query();&#xD;
&#xD;
self.init = function(){	&#xD;
	var dsUser = view.id(&quot;dsUser&quot;);&#xD;
	dsUser.set(&quot;readOnly&quot;,false);&#xD;
	dsUser.clear();&#xD;
	var dsQuery = view.id(&quot;dsUserQuery&quot;);&#xD;
	dsQuery.set(&quot;readOnly&quot;,false);&#xD;
	dsQuery.clear();&#xD;
	dsQuery.insert({});&#xD;
}&#xD;
//设置机构ID&#xD;
self.setDeptId = function(id, name){&#xD;
	self.deptId = id;&#xD;
	self.deptName = name;&#xD;
}&#xD;
&#xD;
var dsSmDeptAutRange =view.id(&quot;dsSmDeptAutRange&quot;); &#xD;
self.doAuthName = function(){&#xD;
	dsSmDeptAutRange.getData().each(&#xD;
	   function(item){&#xD;
	   	   &#xD;
		   if(item.get(&quot;authRangeName&quot;)){&#xD;
		   	   var fullName=item.get(&quot;authRangeName&quot;)&#xD;
			        .replace(/,/g, &quot; -> &quot;);&#xD;
			   item.set(&quot;authRangeName&quot;,fullName)&#xD;
		   }  &#xD;
	   }&#xD;
	);&#xD;
}&#xD;
&#xD;
var dsPepdom=view.id(&quot;dsPepdom&quot;);&#xD;
self.viewPepdom=function(){&#xD;
	&#xD;
	var ds=this.id(&quot;dsUser&quot;).getData(&quot;#&quot;);&#xD;
	var curId=ds.get(&quot;id&quot;);&#xD;
	dsPepdom.set(&quot;parameter&quot;,curId);&#xD;
	dsPepdom.flushAsync(&#xD;
	    function(){ &#xD;
			var pepdom=[];&#xD;
			var items=dsPepdom.getData();&#xD;
			items.each(function(item){&#xD;
				 pepdom.push(item.getData());&#xD;
			}); &#xD;
			view.id(&quot;listPepdom&quot;).set(&quot;items&quot;,pepdom);  &#xD;
			view.id(&quot;dialogPepdom&quot;).show();&#xD;
		}&#xD;
	); &#xD;
}&#xD;
</ClientEvent>
    <DataSet id="dsDept">
      <ClientEvent name="onLoadData">var entity=this.id(&quot;dsDept&quot;).getData(&quot;#&quot;);&#xD;
var param = new Object();&#xD;
	param.deptId = entity.get(&quot;id&quot;);&#xD;
	param.enabled = &quot;1&quot;;&#xD;
	&#xD;
	this.setDeptId(entity.get(&quot;id&quot;), entity.get(&quot;name&quot;));&#xD;
	&#xD;
	var dsUser = this.id(&quot;dsUser&quot;);&#xD;
		&#xD;
	dsUser.set(&quot;parameter&quot;,param);&#xD;
	dsUser.flushAsync();	</ClientEvent>
      <Property name="dataType">[dataTypeDept]</Property>
      <Property name="dataProvider">smDeptCotroller#loadQueryResult</Property>
      <Property name="loadMode">manual</Property>
      <Property name="readOnly">true</Property>
      <Property name="parameter">
        <Entity>
          <Property name="parentIsNull">true</Property>
        </Entity>
      </Property>
    </DataSet>
    <DataSet id="dsDept2">
      <Property name="dataType">[dataTypeDept2]</Property>
      <Property name="dataProvider">smDeptCotroller#loadQueryResult</Property>
      <Property name="loadMode">manual</Property>
      <Property name="readOnly">false</Property>
      <Property name="parameter"></Property>
      <Property name="pageSize">30</Property>
    </DataSet>
    <DataSet id="dsDeptQuery">
      <ClientEvent name="onReady">self.insert({});</ClientEvent>
      <Property name="dataType">[dataTypeDeptQuery]</Property>
    </DataSet>
    <DataSet id="dsDeptEdit">
      <Property name="dataType">dataTypeDept</Property>
    </DataSet>
    <DataSet id="dsUser">
      <Property name="dataProvider">smUserCotroller#loadQueryResult</Property>
      <Property name="dataType">[dataTypeUser]</Property>
      <Property name="loadMode">manual</Property>
      <Property name="pageSize">30</Property>
    </DataSet>
    <DataSet id="dsUserQuery">
      <ClientEvent name="onReady">self.insert({enabled:&quot;1&quot;}, &quot;begin&quot;);</ClientEvent>
      <Property name="dataType">[dataTypeUserQuery]</Property>
    </DataSet>
    <DataSet id="dsUserEdit">
      <Property name="dataType">[dataTypeUser]</Property>
      <Property name="pageSize">15</Property>
    </DataSet>
    <DataSet id="dsSmDeptAutRange">
      <ClientEvent name="onLoadData">this.doAuthName();</ClientEvent>
      <Property name="dataType">[dataTypeDeptAutRange]</Property>
      <Property name="dataProvider">smDeptAutRangeCotroller#loadQueryResult</Property>
    </DataSet>
    <DataSet id="dsPepdom">
      <Property name="dataProvider">smUserCotroller#viewPepdom</Property>
      <Property name="loadMode">manual</Property>
      <Property name="dataType">[urlType]</Property>
    </DataSet>
    <SplitPanel>
      <Property name="collapseable">false</Property>
      <Property name="position">20%</Property>
      <Property name="resizeable">false</Property>
      <MainControl>
        <Container>
          <AutoForm id="queryUserAutoForm">
            <Property name="cols">*,*,*,*</Property>
            <Property name="dataSet">dsUserQuery</Property>
            <Property name="labelAlign">right</Property>
            <Property name="labelWidth">120</Property>
            <AutoFormElement>
              <Property name="name">many</Property>
              <Property name="property">many</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">deptName</Property>
              <Property name="property">deptName</Property>
              <Property name="hideMode">display</Property>
              <Property name="visible">false</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">enabled</Property>
              <Property name="property">enabled</Property>
              <Editor/>
            </AutoFormElement>
          </AutoForm>
          <ToolBar>
            <DataPilot>
              <Property name="dataSet">dsUser</Property>
              <Property name="itemCodes">pages</Property>
            </DataPilot>
            <ToolBarButton id="userQueryBtn">
              <ClientEvent name="onClick">var node = view.id('dataTreeGridDept').get(&quot;currentNode&quot;);&#xD;
var record =node.get(&quot;data&quot;);&#xD;
&#xD;
var entity = view.id(&quot;queryUserAutoForm&quot;).get(&quot;entity&quot;);&#xD;
&#xD;
var param = new Object();&#xD;
param.deptId = record.get(&quot;id&quot;);&#xD;
if (entity) {&#xD;
	param.many = entity.get(&quot;many&quot;);&#xD;
	param.deptName = entity.get(&quot;deptName&quot;);&#xD;
	param.enabled = entity.get(&quot;enabled&quot;);&#xD;
}&#xD;
&#xD;
var ds = this.id(&quot;dsUser&quot;); &#xD;
ds.set(&quot;parameter&quot;, param).flushAsync();</ClientEvent>
              <Property name="icon"> url(>skin>common/icons.gif) -20px -40px</Property>
              <Property name="caption">查询</Property>
            </ToolBarButton>
            <ToolBarButton id="userAddBtn">
              <ClientEvent name="onClick">view.opp = &quot;1&quot;;&#xD;
var dialog = view.id(&quot;dialogUserEdit&quot;);	&#xD;
&#xD;
if(view.deptId == null) {&#xD;
	dorado.MessageBox.alert(&quot;请选择需要新增用户的机构&quot;);&#xD;
	return;&#xD;
}&#xD;
&#xD;
dialog.show();</ClientEvent>
              <Property name="caption">新增</Property>
              <Property name="icon">url(>skin>common/icons.gif) -120px -0px</Property>
            </ToolBarButton>
            <ToolBarButton id="userUpdateBtn">
              <ClientEvent name="onClick">view.opp = &quot;2&quot;;&#xD;
var dialog = view.id(&quot;dialogUserEdit&quot;);	 &#xD;
dialog.show();</ClientEvent>
              <Property name="caption">修改</Property>
              <Property name="icon">url(skin>common/icons.gif) -200px 0px</Property>
            </ToolBarButton>
            <ToolBarButton id="userDelBtn">
              <ClientEvent name="onClick">var dsUser = this.id(&quot;dsUser&quot;);	&#xD;
var record = dsUser.getData(&quot;#&quot;);&#xD;
var deptId = record.get(&quot;dept.id&quot;);&#xD;
var action = view.id(&quot;ajaxActionDel&quot;);&#xD;
action.set(&quot;parameter&quot;,record.get(&quot;id&quot;)).execute(function(){&#xD;
	var param = new Object();&#xD;
	param.deptId = deptId;&#xD;
	param.enabled = &quot;1&quot;;	&#xD;
	&#xD;
	dsUser.set(&quot;parameter&quot;,param);&#xD;
	dsUser.flushAsync();&#xD;
	&#xD;
	view.get(&quot;#queryUserAutoForm.entity&quot;).set(&quot;enabled&quot;,&quot;1&quot;);&#xD;
});</ClientEvent>
              <Property name="caption">删除</Property>
              <Property name="icon">url(>skin>common/icons.gif) -140px -0px</Property>
            </ToolBarButton>
            <ToolBarButton id="userResumeBtn">
              <ClientEvent name="onClick">var dsUser = this.id(&quot;dsUser&quot;);	&#xD;
var record = dsUser.getData(&quot;#&quot;);&#xD;
var deptId = record.get(&quot;dept.id&quot;);&#xD;
var action = view.id(&quot;ajaxActionResume&quot;);&#xD;
action.set(&quot;parameter&quot;,record.get(&quot;id&quot;)).execute(function(){&#xD;
	var param = new Object();&#xD;
	param.deptId = deptId;&#xD;
	param.enabled = &quot;1&quot;;&#xD;
	&#xD;
	dsUser.set(&quot;parameter&quot;,param);&#xD;
	dsUser.flushAsync();&#xD;
	&#xD;
	view.get(&quot;#queryUserAutoForm.entity&quot;).set(&quot;enabled&quot;,&quot;1&quot;);&#xD;
});</ClientEvent>
              <Property name="caption">启用</Property>
              <Property name="icon">url(>skin>common/icons.gif) -220px -20px</Property>
            </ToolBarButton>
            <ToolBarButton id="modifyPasswordBtn">
              <ClientEvent name="onClick">var dialog = view.id(&quot;dialogModifyPassword&quot;);	 &#xD;
dialog.show();</ClientEvent>
              <Property name="caption">修改密码</Property>
              <Property name="icon">url(>skin>common/icons.gif) -160px -100px</Property>
            </ToolBarButton>
            <ToolBarButton id="buttonPower" layoutConstraint="align:right">
              <ClientEvent name="onClick">view.viewPepdom();&#xD;
</ClientEvent>
              <Property name="caption">查看权限</Property>
              <Property name="icon">url(>skin>common/icons.gif) -160px -100px</Property>
            </ToolBarButton>
          </ToolBar>
          <DataGrid id="dataGridUser" layoutConstraint="padding:10px">
            <Property name="dataSet">dsUser</Property>
            <DataColumn>
              <Property name="name">username</Property>
              <Property name="property">username</Property>
              <Property name="editable">false</Property>
              <Property name="readOnly">true</Property>
              <Editor/>
            </DataColumn>
            <DataColumn>
              <Property name="name">cname</Property>
              <Property name="property">cname</Property>
              <Property name="editable">false</Property>
              <Property name="readOnly">true</Property>
              <Editor/>
            </DataColumn>
            <DataColumn>
              <Property name="name">mobile</Property>
              <Property name="property">mobile</Property>
              <Property name="editable">false</Property>
              <Property name="readOnly">true</Property>
              <Editor/>
            </DataColumn>
            <DataColumn>
              <Property name="name">enabled</Property>
              <Property name="property">enabled</Property>
              <Property name="readOnly">true</Property>
              <Property name="editable">false</Property>
              <Editor/>
            </DataColumn>
            <DataColumn>
              <Property name="visible">false</Property>
              <Property name="editable">false</Property>
              <Property name="readOnly">true</Property>
              <Editor/>
            </DataColumn>
            <DataColumn>
              <Property name="name">所属机构</Property>
              <Property name="property">dept.name</Property>
              <Property name="readOnly">true</Property>
              <Property name="editable">false</Property>
              <Editor/>
            </DataColumn>
          </DataGrid>
        </Container>
      </MainControl>
      <SideControl>
        <Container>
          <AutoForm id="queryDeptAutoForm" layoutConstraint="padding:10px">
            <Property name="dataSet">dsDeptQuery</Property>
            <Property name="labelAlign">left</Property>
            <Property name="labelWidth">65</Property>
            <Property name="cols">*</Property>
            <AutoFormElement>
              <Property name="name">name</Property>
              <Property name="property">name</Property>
              <Editor/>
            </AutoFormElement>
          </AutoForm>
          <ToolBar>
            <ToolBarButton id="deptQueryBtn">
              <ClientEvent name="onClick">view.id('dataTreeGridDept').clearNodes();&#xD;
&#xD;
var entity = this.id(&quot;queryDeptAutoForm&quot;).get(&quot;entity&quot;);&#xD;
if(entity){&#xD;
	this.id(&quot;dsDept&quot;).set(&quot;parameter&quot;, entity);&#xD;
}&#xD;
this.id(&quot;dsDept&quot;).flushAsync();</ClientEvent>
              <Property name="icon"> url(>skin>common/icons.gif) -20px -40px</Property>
              <Property name="caption">查询</Property>
            </ToolBarButton>
            <ToolBarButton id="deptAddBtn">
              <ClientEvent name="onClick">view.opp = &quot;0&quot;;         //新增操作&#xD;
&#xD;
var dsDeptEdit = view.id('dsDeptEdit');&#xD;
dsDeptEdit.set(&quot;readOnly&quot;,false);&#xD;
dsDeptEdit.clear();&#xD;
&#xD;
var record = view.id('dataTreeGridDept').get(&quot;currentEntity&quot;);&#xD;
if(!record){&#xD;
    dorado.MessageBox.alert(&quot;请选择要增加机构的上级&quot;);&#xD;
	return;&#xD;
}&#xD;
&#xD;
var newrecord = dsDeptEdit.insert({});&#xD;
newrecord.set('parentName',record.get(&quot;name&quot;));&#xD;
newrecord.set('parentId',record.get(&quot;id&quot;));&#xD;
newrecord.set('enabled',&quot;0&quot;);&#xD;
&#xD;
&#xD;
view.id(&quot;dialogDept&quot;).set(&quot;caption&quot;,&quot;新增机构信息&quot;).show();</ClientEvent>
              <Property name="caption">新增</Property>
              <Property name="icon">url(>skin>common/icons.gif) -120px -0px</Property>
            </ToolBarButton>
            <ToolBarButton id="deptUpdateBtn">
              <ClientEvent name="onClick">view.opp = &quot;1&quot;;         //修改操作&#xD;
&#xD;
var dsDeptEdit = view.id('dsDeptEdit');&#xD;
dsDeptEdit.set(&quot;readOnly&quot;,false);&#xD;
dsDeptEdit.clear();&#xD;
&#xD;
var node = view.id('dataTreeGridDept').get(&quot;currentNode&quot;);&#xD;
var record =node.get(&quot;data&quot;);&#xD;
if(!record){&#xD;
    dorado.MessageBox.alert(&quot;没有记录被选中&quot;);&#xD;
}&#xD;
&#xD;
dsDeptEdit.insert(record);&#xD;
dsDeptEdit.getData(&quot;#&quot;).set('lastUpdateTime',record.get(&quot;lastUpdateTime&quot;));&#xD;
dsDeptEdit.getData(&quot;#&quot;).set('lastUpdatePerson',record.get(&quot;lastUpdatePerson&quot;));&#xD;
if(record.get(&quot;parentId&quot;)!=null){&#xD;
    var parentNode = node.get(&quot;parent&quot;);&#xD;
	var parentRecord = parentNode.get(&quot;data&quot;);&#xD;
	if(parentRecord.parent != undefined) {&#xD;
	    dsDeptEdit.getData(&quot;#&quot;).set('parentName',parentRecord.get(&quot;name&quot;));		&#xD;
	} else {&#xD;
		dsDeptEdit.getData(&quot;#&quot;).set('parentName',record.get(&quot;parentName&quot;));	&#xD;
	}&#xD;
}&#xD;
&#xD;
view.id(&quot;dialogDept&quot;).show();&#xD;
</ClientEvent>
              <Property name="caption">修改</Property>
              <Property name="icon">url(skin>common/icons.gif) -200px 0px</Property>
            </ToolBarButton>
            <ToolBarButton id="deptDelBtn">
              <ClientEvent name="onClick">var dsDeptEdit = view.id('dsDeptEdit');&#xD;
dsDeptEdit.set(&quot;readOnly&quot;,false);&#xD;
dsDeptEdit.clear();&#xD;
&#xD;
var record = view.id('dataTreeGridDept').get(&quot;currentEntity&quot;);&#xD;
if(!record){&#xD;
	dorado.MessageBox.alert(&quot;请选择要删除的记录!&quot;);&#xD;
	return;&#xD;
}&#xD;
 &#xD;
if(record.get(&quot;parentId&quot;)==null){&#xD;
    dorado.MessageBox.alert(&quot;不能删除最顶级机构!&quot;);&#xD;
    return;&#xD;
}&#xD;
&#xD;
dsDeptEdit.insert(record);&#xD;
var action = view.id(&quot;updateActionDeptDel&quot;);&#xD;
action.execute(function(){  &#xD;
    view.query();&#xD;
});&#xD;
</ClientEvent>
              <Property name="caption">删除</Property>
              <Property name="icon">url(>skin>common/icons.gif) -140px -0px</Property>
            </ToolBarButton>
            <ToolBarButton id="btn_scope">
              <ClientEvent name="onClick">var dsSmDeptAutRange = view.id(&quot;dsSmDeptAutRange&quot;);&#xD;
var record = view.id('dataTreeGridDept').get(&quot;currentEntity&quot;);&#xD;
dsSmDeptAutRange.set(&quot;parameter&quot;,{&quot;deptId&quot;:record.get(&quot;id&quot;)});&#xD;
dsSmDeptAutRange.flushAsync(function(){&#xD;
	view.id(&quot;dialogDeptAutRange&quot;).show();&#xD;
});</ClientEvent>
              <Property name="caption">权限范围</Property>
              <Property name="icon"> url(>skin>common/icons.gif) -140px -100px</Property>
            </ToolBarButton>
          </ToolBar>
          <DataTreeGrid id="dataTreeGridDept">
            <ClientEvent name="onDataRowClick">var node = view.id('dataTreeGridDept').get(&quot;currentNode&quot;);&#xD;
var record =node.get(&quot;data&quot;);&#xD;
&#xD;
view.init();&#xD;
var param = new Object();&#xD;
param.deptId = record.get(&quot;id&quot;);&#xD;
param.enabled = &quot;1&quot;;&#xD;
&#xD;
view.setDeptId(record.get(&quot;id&quot;), record.get(&quot;name&quot;));&#xD;
&#xD;
var dsUser = this.id(&quot;dsUser&quot;);&#xD;
	&#xD;
dsUser.set(&quot;parameter&quot;,param);&#xD;
dsUser.flushAsync();</ClientEvent>
            <Property name="dataSet">dsDept</Property>
            <Property name="readOnly">true</Property>
            <Property name="treeColumn">name</Property>
            <Property name="stretchColumnsMode">allColumns</Property>
            <BindingConfigs>
              <BindingConfig>
                <Property name="labelProperty">name</Property>
                <Property name="recursive">true</Property>
                <Property name="expandLevel">1</Property>
                <Property name="childrenProperty">children</Property>
              </BindingConfig>
            </BindingConfigs>
            <Columns>
              <DataColumn>
                <Property name="property">name</Property>
                <Property name="caption">机构名称</Property>
                <Property name="width">30%</Property>
              </DataColumn>
              <DataColumn>
                <Property name="property">enabled</Property>
                <Property name="width">5%</Property>
                <Property name="caption">是否可用</Property>
                <Property name="name">enabled</Property>
                <Property name="visible">false</Property>
              </DataColumn>
              <DataColumn>
                <Property name="caption">最后修改时间</Property>
                <Property name="property">lastUpdateTime</Property>
                <Property name="width">10%</Property>
                <Property name="visible">false</Property>
              </DataColumn>
              <DataColumn>
                <Property name="caption">最后修改人</Property>
                <Property name="property">lastUpdatePerson</Property>
                <Property name="width">5%</Property>
                <Property name="visible">false</Property>
              </DataColumn>
              <DataColumn id="id2">
                <Property name="property">id</Property>
                <Property name="visible">false</Property>
              </DataColumn>
            </Columns>
          </DataTreeGrid>
        </Container>
      </SideControl>
    </SplitPanel>
    <Dialog id="dialogDept">
      <ClientEvent name="onShow">if(view.opp==&quot;0&quot;){&#xD;
	self.set('caption','新增机构');&#xD;
	view.id(&quot;enabled&quot;).set(&quot;visible&quot;,false);&#xD;
	view.id(&quot;lastUpdatePerson&quot;).set(&quot;visible&quot;,false);&#xD;
	view.id(&quot;lastUpdateTime&quot;).set(&quot;visible&quot;,false);&#xD;
&#xD;
	self.set(&quot;height&quot;,&quot;300&quot;);&#xD;
}else if (view.opp==&quot;1&quot;){&#xD;
	self.set('caption','修改机构');&#xD;
	//view.id(&quot;enabled&quot;).set(&quot;visible&quot;,true);&#xD;
	view.id(&quot;lastUpdatePerson&quot;).set(&quot;visible&quot;,true);&#xD;
	view.id(&quot;lastUpdateTime&quot;).set(&quot;visible&quot;,true);&#xD;
&#xD;
	self.set(&quot;height&quot;,&quot;360&quot;);&#xD;
}else{&#xD;
	self.set('caption','查看机构');&#xD;
	view.id(&quot;enabled&quot;).set(&quot;visible&quot;,true);&#xD;
	view.id(&quot;lastUpdatePerson&quot;).set(&quot;visible&quot;,true);&#xD;
    view.id(&quot;lastUpdateTime&quot;).set(&quot;visible&quot;,true);&#xD;
}</ClientEvent>
      <Property name="height">400</Property>
      <Property name="width">600</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">var action =view.id(&quot;updateActionDeptEdit&quot;);&#xD;
&#xD;
action.execute(function(){	&#xD;
	view.id(&quot;dialogDept&quot;).hide();&#xD;
	view.query();&#xD;
});</ClientEvent>
          <Property name="caption">保存</Property>
          <Property name="icon"> url(>skin>common/icons.gif) -140px -20px</Property>
        </Button>
        <Button>
          <ClientEvent name="onClick">view.id(&quot;dialogDept&quot;).hide();</ClientEvent>
          <Property name="caption">关闭</Property>
          <Property name="icon"> url(>skin>common/icons.gif) -40px -0px</Property>
        </Button>
      </Buttons>
      <Children>
        <AutoForm>
          <Property name="cols">*,*</Property>
          <Property name="dataSet">dsDeptEdit</Property>
          <Property name="labelWidth">90</Property>
          <Property name="visible">true</Property>
          <AutoFormElement id="parentName">
            <Property name="name">parentName</Property>
            <Property name="label">上级机构</Property>
            <Property name="editable">true</Property>
            <Property name="readOnly">true</Property>
            <Property name="hideMode">display</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement id="systemId">
            <Property name="name">systemId</Property>
            <Property name="property">systemId</Property>
            <Property name="editable">false</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">name</Property>
            <Property name="property">name</Property>
            <Property name="hideMode">visibility</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">areaName</Property>
            <Property name="property">areaName</Property>
            <Property name="editable">false</Property>
            <Property name="trigger">triggerArea</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement id="enabled">
            <Property name="name">enabled</Property>
            <Property name="property">enabled</Property>
            <Property name="visible">false</Property>
            <Property name="hideMode">display</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement id="address" layoutConstraint="colSpan:2">
            <Property name="name">address</Property>
            <Property name="property">address</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement id="desc" layoutConstraint="colSpan:2">
            <Property name="name">desc</Property>
            <Property name="property">desc</Property>
            <Property name="editorType">TextArea</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement id="lastUpdatePerson">
            <Property name="name">lastUpdatePerson</Property>
            <Property name="property">lastUpdatePerson</Property>
            <Property name="hideMode">display</Property>
            <Property name="readOnly">true</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement id="lastUpdateTime">
            <Property name="name">lastUpdateTime</Property>
            <Property name="property">lastUpdateTime</Property>
            <Property name="hideMode">display</Property>
            <Property name="readOnly">true</Property>
            <Editor/>
          </AutoFormElement>
        </AutoForm>
      </Children>
      <Tools/>
    </Dialog>
    <Trigger id="triggerArea">
      <ClientEvent name="onExecute">var dialog = this.id(&quot;dialogRegion&quot;);&#xD;
var e = arg.editor.get('property');&#xD;
var obj = arg.editor.get('entity');&#xD;
dialog.show(&#xD;
{&#xD;
	&quot;caption&quot;:&quot;选择区域&quot;,&#xD;
	&quot;width&quot;:&quot;370&quot;,&#xD;
	&quot;height&quot;:&quot;450&quot;,&#xD;
	&quot;onSelect&quot;:function(o){&#xD;
		if( o != null )&#xD;
		{	&#xD;
			obj.set(&quot;areaName&quot;,o.get(&quot;regionName&quot;));&#xD;
			obj.set(&quot;areaId&quot;,o.get(&quot;id&quot;));&#xD;
		}		&#xD;
	}	&#xD;
});</ClientEvent>
    </Trigger>
    <Import id="RegionImport" src="com.lanshan.web.admin.sm.view.Common#dialogRegion"/>
    <UpdateAction id="updateActionDeptEdit">
      <Property name="successMessage">操作成功</Property>
      <Property name="dataResolver">smDeptCotroller#save</Property>
      <UpdateItem>
        <Property name="dataPath">[#current]</Property>
        <Property name="dataSet">dsDeptEdit</Property>
      </UpdateItem>
    </UpdateAction>
    <UpdateAction id="updateActionDeptDel">
      <Property name="successMessage">操作成功</Property>
      <Property name="dataResolver">smDeptCotroller#delete</Property>
      <Property name="confirmMessage">确定要删除此机构吗？</Property>
      <UpdateItem>
        <Property name="dataPath">[#current]</Property>
        <Property name="dataSet">dsDeptEdit</Property>
      </UpdateItem>
    </UpdateAction>
    <Dialog id="dialogUserEdit">
      <ClientEvent name="onClose">view.id(&quot;dialogUserEdit&quot;).hide(); &#xD;
view.id(&quot;dsUser&quot;).getData().cancel(); </ClientEvent>
      <ClientEvent name="onShow">switch(view.opp){ &#xD;
	//新增&#xD;
	case &quot;1&quot;: self.set({&quot;caption&quot;:&quot;用户-新增&quot;});&#xD;
			  var dsUser = view.id(&quot;dsUser&quot;);&#xD;
			  //view.id(&quot;editPositionSelect&quot;).set(&quot;readOnly&quot;,false); &#xD;
			  //view.id(&quot;editDeptSelect&quot;).set(&quot;readOnly&quot;,false); &#xD;
			  view.id(&quot;password&quot;).set(&quot;visible&quot;,true); &#xD;
			  dsUser.set(&quot;readOnly&quot;,false);&#xD;
			  dsUser.insert({&quot;enabled&quot;:&quot;1&quot;,&quot;male&quot;:&quot;0&quot;,&quot;dept&quot;:{&quot;id&quot;:view.deptId, &quot;name&quot;:view.deptName}},&quot;begin&quot;); &#xD;
			  break;&#xD;
			  &#xD;
	//修改&#xD;
	case &quot;2&quot;: self.set({&quot;caption&quot;:&quot;用户-修改&quot;});&#xD;
	          //view.id(&quot;editPositionSelect&quot;).set(&quot;readOnly&quot;,true); &#xD;
			  //view.id(&quot;editDeptSelect&quot;).set(&quot;readOnly&quot;,true); &#xD;
			  view.id(&quot;password&quot;).set(&quot;visible&quot;,false); &#xD;
	          var judeParams={};&#xD;
	          //judeParams.key='EDIT_POSITION';&#xD;
			  var dsUser = view.id(&quot;dsUser&quot;);&#xD;
			  dsUser.set(&quot;readOnly&quot;,false);&#xD;
			  var userId=dsUser.getData(&quot;#.id&quot;);&#xD;
			  judeParams.userId=userId;&#xD;
			  //view.id(&quot;judgeByRoleAction&quot;).set(&quot;parameter&quot;,judeParams);&#xD;
			  //view.id(&quot;judgeByRoleAction&quot;).execute(&#xD;
			     //function(d){&#xD;
				 	  //view.id(&quot;editPositionSelect&quot;).set(&quot;readOnly&quot;,!d);&#xD;
					  //view.id(&quot;editDeptSelect&quot;).set(&quot;readOnly&quot;,!d);   &#xD;
				 //}&#xD;
			  //);&#xD;
			  break;	&#xD;
			  	&#xD;
	//查看		  &#xD;
	case &quot;0&quot;: self.set({&quot;caption&quot;:&quot;用户-查看&quot;});&#xD;
              var dsUser = view.id(&quot;dsUser&quot;);&#xD;
              dsUser.set(&quot;readOnly&quot;,true);&#xD;
              &#xD;
              break;		  	  &#xD;
	&#xD;
};&#xD;
</ClientEvent>
      <Property name="height">320</Property>
      <Property name="width">600</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">var action =view.id(&quot;updateActionUserEdit&quot;);&#xD;
&#xD;
action.execute(function(){  &#xD;
    view.id(&quot;dialogUserEdit&quot;).hide();&#xD;
	&#xD;
	var param = new Object();&#xD;
	param.deptId = view.deptId;&#xD;
	param.enabled = &quot;1&quot;;	&#xD;
	&#xD;
	dsUser.set(&quot;parameter&quot;,param);&#xD;
	dsUser.flushAsync();&#xD;
	&#xD;
	view.get(&quot;#queryUserAutoForm.entity&quot;).set(&quot;enabled&quot;,&quot;1&quot;);&#xD;
});</ClientEvent>
          <Property name="caption">保存</Property>
          <Property name="icon"> url(>skin>common/icons.gif) -140px -20px</Property>
        </Button>
        <Button>
          <ClientEvent name="onClick">view.id(&quot;dialogUserEdit&quot;).hide(); &#xD;
view.id(&quot;dsUser&quot;).getData().cancel(); </ClientEvent>
          <Property name="icon"> url(>skin>common/icons.gif) -40px -0px</Property>
          <Property name="caption">关闭</Property>
        </Button>
      </Buttons>
      <Children>
        <AutoForm id="formUserEdit">
          <Property name="height">100%</Property>
          <Property name="labelWidth">90</Property>
          <Property name="dataSet">dsUser</Property>
          <Property name="width">100%</Property>
          <AutoFormElement>
            <Property name="name">username</Property>
            <Property name="property">username</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">cname</Property>
            <Property name="property">cname</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">mobile</Property>
            <Property name="property">mobile</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">enabled</Property>
            <Property name="property">enabled</Property>
            <Property name="readOnly">true</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">male</Property>
            <Property name="property">male</Property>
            <Property name="editable">false</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement id="password">
            <Property name="name">password</Property>
            <Property name="property">password</Property>
            <Property name="editorType">PasswordEditor</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">weixinOpenId</Property>
            <Property name="property">weixinOpenId</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">dept.name</Property>
            <Property name="property">dept.name</Property>
            <Property name="readOnly">true</Property>
            <Property name="label">所属机构</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">dept.id</Property>
            <Property name="property">dept.id</Property>
            <Property name="visible">false</Property>
            <Property name="hideMode">display</Property>
            <Property name="readOnly">true</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement layoutConstraint="colSpan:2">
            <Property name="name">positionsFullName</Property>
            <Property name="property">positionsFullName</Property>
            <Property name="editorType">TextArea</Property>
            <Property name="trigger">triggerPosition</Property>
            <Editor/>
          </AutoFormElement>
        </AutoForm>
      </Children>
      <Tools/>
    </Dialog>
    <AjaxAction id="ajaxActionDel">
      <Property name="confirmMessage">确定要删除用户信息吗?</Property>
      <Property name="successMessage">删除成功</Property>
      <Property name="service">smUserCotroller#deleteById</Property>
    </AjaxAction>
    <AjaxAction id="ajaxActionResume">
      <Property name="confirmMessage">确定要启用该用户吗?</Property>
      <Property name="successMessage">成功启用</Property>
      <Property name="service">smUserCotroller#resume</Property>
    </AjaxAction>
    <Trigger id="triggerPosition">
      <ClientEvent name="onExecute">var record = view.id(&quot;dsUser&quot;).getData(&quot;#&quot;); &#xD;
var dialog = this.id(&quot;dialogTableSelectPosition&quot;);&#xD;
var config = {&#xD;
    caption: &quot;用户岗位选择&quot;, &#xD;
	//data:dataSetOwnPosition,&#xD;
    onSelect: function(o){ &#xD;
		if(o){&#xD;
			 record.set(&quot;positions&quot;,o);&#xD;
			 var positName=&quot;&quot;;&#xD;
			 o.each(function(node) { &#xD;
		        positName+=&quot;,&quot;+ node.get(&quot;name&quot;); &#xD;
	        }); &#xD;
			record.set(&quot;positionsFullName&quot;,positName.substring(1));&#xD;
        }else{&#xD;
			dorado.MessageBox.alert(&quot;请选择有效岗位！&quot;);&#xD;
			return false;	&#xD;
		}   &#xD;
    }&#xD;
}&#xD;
dialog.show(config);</ClientEvent>
    </Trigger>
    <Dialog id="dialogTableSelectPosition">
      <ClientEvent name="onReady">self.setBack = function(o){&#xD;
	if( o ){&#xD;
		var cb = this.$$callback;&#xD;
        if(cb){&#xD;
			cb(o);  &#xD;
		}&#xD;
	}&#xD;
}&#xD;
&#xD;
&#xD;
self._$doShow = self.doShow;&#xD;
self.doShow = function(p)&#xD;
{&#xD;
	if(!p.oParam)&#xD;
	   p.oParam = p;&#xD;
	this._$oParam = p.oParam;&#xD;
	var o = this._$oParam;&#xD;
	if(o.caption){&#xD;
        self.set(&quot;width&quot;,o.caption);&#xD;
    }&#xD;
	if(o.width){&#xD;
		self.set(&quot;width&quot;,o.width);&#xD;
	}&#xD;
	if(o.height){&#xD;
		self.set(&quot;height&quot;,o.height);&#xD;
	}&#xD;
	view.id(&quot;dataGridSelectPosition&quot;).set(&quot;selectionMode&quot;,'multiRows');		&#xD;
	var dataset =  view.id(&quot;dataSetPosition&quot;);&#xD;
	&#xD;
	if(o.appParam){		&#xD;
		dataset.set(&quot;parameter&quot;,o.appParam);&#xD;
	}&#xD;
	dataset.flush();&#xD;
	selectPosititons(dataset);&#xD;
	&#xD;
	this.$$callback = o[&quot;onSelect&quot;];&#xD;
	this._$doShow(p);	&#xD;
};&#xD;
&#xD;
function selectPosititons(dataset){&#xD;
	var records = view.id(&quot;dsUser&quot;).getData(&quot;#.positions&quot;).toJSON(); &#xD;
	if (records)&#xD;
		for(var i=0;i&lt;records.length;i++){&#xD;
			dataset.getData().each(function(n){&#xD;
				if(n.get(&quot;id&quot;)==records[i].id){&#xD;
					n.set(&quot;selected&quot;,true);&#xD;
				}&#xD;
			});&#xD;
		}	 &#xD;
}</ClientEvent>
      <Property name="caption">岗位选择</Property>
      <Property name="height">400</Property>
      <Property name="width">600</Property>
      <Buttons>
        <Button id="btnSelPositionOk">
          <ClientEvent name="onClick">var dialog=this.id(&quot;dialogTableSelectPosition&quot;);&#xD;
var dataTable = this.id(&quot;dataGridSelectPosition&quot;);&#xD;
var datas = dataTable.get(&quot;selection&quot;);	&#xD;
if(!datas || datas.length==0){&#xD;
	dorado.MessageBox.alert(&quot;请选择岗位！&quot;);&#xD;
}else{ &#xD;
    dialog.setBack(datas);&#xD;
	dialog.hide();&#xD;
}</ClientEvent>
          <Property name="caption">确定</Property>
          <Property name="icon">url(skin>common/icons.gif) -140px -20px</Property>
        </Button>
        <Button id="btnSelPositionCancel">
          <ClientEvent name="onClick">var dialog = this.id(&quot;dialogTableSelectPosition&quot;);&#xD;
dialog.hide();</ClientEvent>
          <Property name="caption">取消</Property>
          <Property name="icon">url(skin>common/icons.gif) -40px 0px</Property>
        </Button>
      </Buttons>
      <Children>
        <DataSet id="dataSetPosition">
          <Property name="dataType">[smPosition]</Property>
          <Property name="dataProvider">smPositionCotrller#queryResult</Property>
          <Property name="loadMode">manual</Property>
          <Property name="pageSize">15</Property>
        </DataSet>
        <DataPilot>
          <Property name="dataSet">dataSetPosition</Property>
        </DataPilot>
        <DataGrid id="dataGridSelectPosition">
          <Property name="dataSet">dataSetPosition</Property>
          <Property name="readOnly">true</Property>
          <Property name="showFilterBar">true</Property>
          <Property name="selectionMode">multiRows</Property>
          <Property name="rowSelectionProperty">selected</Property>
          <RowSelectorColumn id="rowSelectorPosition"/>
          <DataColumn>
            <Property name="name">id</Property>
            <Property name="property">id</Property>
            <Property name="filterable">false</Property>
            <Property name="visible">false</Property>
            <Editor/>
          </DataColumn>
          <DataColumn>
            <Property name="name">name</Property>
            <Property name="property">name</Property>
            <Property name="caption">名称</Property>
            <Editor/>
          </DataColumn>
          <DataColumn>
            <Property name="name">desc</Property>
            <Property name="property">desc</Property>
            <Property name="caption">描述</Property>
            <Editor/>
          </DataColumn>
          <DataColumn id="selected">
            <Property name="visible">false</Property>
            <Editor/>
          </DataColumn>
        </DataGrid>
      </Children>
      <Tools/>
    </Dialog>
    <UpdateAction id="updateActionUserEdit">
      <Property name="dataResolver">smUserCotroller#save</Property>
      <Property name="successMessage">操作成功</Property>
      <UpdateItem>
        <Property name="dataPath">[#current]</Property>
        <Property name="dataSet">dsUser</Property>
      </UpdateItem>
    </UpdateAction>
    <Dialog id="dialogModifyPassword">
      <ClientEvent name="onClose">view.id(&quot;dialogModifyPassword&quot;).hide(); &#xD;
view.id(&quot;dsUser&quot;).getData().cancel(); </ClientEvent>
      <ClientEvent name="onShow">self.set({&quot;caption&quot;:&quot;用户-修改密码&quot;});&#xD;
&#xD;
var dsUser = view.id(&quot;dsUser&quot;);&#xD;
var entity = dsUser.getData(&quot;#&quot;);&#xD;
//entity.set(&quot;oldPassword&quot;, &quot;&quot;);&#xD;
console.log(entity);&#xD;
//dsUser.insert({&quot;id&quot;: entity.get(&quot;id&quot;)},&quot;begin&quot;); &#xD;
var id = entity.get(&quot;id&quot;);&#xD;
view.get(&quot;#dsUser&quot;).set(&quot;parameter&quot;,{id:id}).flushAsync();&#xD;
return true;</ClientEvent>
      <Property name="height">240</Property>
      <Property name="width">400</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">var action =view.id(&quot;updateActionModifyPassword&quot;);&#xD;
&#xD;
action.execute(function(){  &#xD;
    view.id(&quot;dialogModifyPassword&quot;).hide();&#xD;
});</ClientEvent>
          <Property name="caption">保存</Property>
          <Property name="icon"> url(>skin>common/icons.gif) -140px -20px</Property>
        </Button>
        <Button>
          <ClientEvent name="onClick">view.id(&quot;dialogModifyPassword&quot;).hide(); &#xD;
view.id(&quot;dsUser&quot;).getData().cancel(); </ClientEvent>
          <Property name="icon"> url(>skin>common/icons.gif) -40px -0px</Property>
          <Property name="caption">关闭</Property>
        </Button>
      </Buttons>
      <Children>
        <AutoForm id="formModifyPassword">
          <Property name="dataSet">dsUser</Property>
          <Property name="height">100%</Property>
          <Property name="labelWidth">90</Property>
          <Property name="width">100%</Property>
          <Property name="cols">*</Property>
          <AutoFormElement>
            <Property name="name">oldPassword</Property>
            <Property name="property">oldPassword</Property>
            <Property name="editorType">PasswordEditor</Property>
            <Property name="hideMode">display</Property>
            <Property name="visible">false</Property>
            <Editor>
              <PasswordEditor>
                <Property name="blankText">请输入原密码</Property>
              </PasswordEditor>
            </Editor>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">newPassword</Property>
            <Property name="property">newPassword</Property>
            <Property name="editorType">PasswordEditor</Property>
            <Editor>
              <PasswordEditor>
                <Property name="blankText">请设置新密码</Property>
              </PasswordEditor>
            </Editor>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">againPassword</Property>
            <Property name="property">againPassword</Property>
            <Property name="editorType">PasswordEditor</Property>
            <Editor>
              <PasswordEditor>
                <Property name="blankText">请再次输入新密码</Property>
              </PasswordEditor>
            </Editor>
          </AutoFormElement>
        </AutoForm>
      </Children>
      <Tools/>
    </Dialog>
    <UpdateAction id="updateActionModifyPassword">
      <ClientEvent name="onSuccess">var entity=this.id(&quot;dsUser&quot;).getData(&quot;#&quot;);&#xD;
//entity.set(&quot;oldPassword&quot;, null);&#xD;
//entity.set(&quot;newPassword&quot;, null);&#xD;
//entity.set(&quot;againPassword&quot;, null);&#xD;
</ClientEvent>
      <Property name="dataResolver">smUserCotroller#savePassword</Property>
      <Property name="successMessage">操作成功</Property>
      <UpdateItem>
        <Property name="dataPath">[#current]</Property>
        <Property name="dataSet">dsUser</Property>
      </UpdateItem>
    </UpdateAction>
    <Dialog id="dialogDeptAutRange">
      <Property name="caption">权限范围设置</Property>
      <Property name="height">400</Property>
      <Property name="width">600</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">var action =view.id(&quot;updateActionRangeDept&quot;);&#xD;
action.execute(function(){  &#xD;
    view.id(&quot;dialogDeptAutRange&quot;).hide();&#xD;
});</ClientEvent>
          <Property name="caption">保存</Property>
          <Property name="icon"> url(>skin>common/icons.gif) -140px -20px</Property>
        </Button>
        <Button>
          <ClientEvent name="onClick">view.id(&quot;dialogDeptAutRange&quot;).hide();</ClientEvent>
          <Property name="caption">关闭</Property>
          <Property name="icon"> url(>skin>common/icons.gif) -40px -0px</Property>
        </Button>
      </Buttons>
      <Children>
        <ToolBar>
          <ToolBarButton>
            <ClientEvent name="onClick">var dsSmDeptAutRange = view.id(&quot;dsSmDeptAutRange&quot;);&#xD;
var record = view.id('dataTreeGridDept').get(&quot;currentEntity&quot;);&#xD;
dsSmDeptAutRange.insert({deptId:record.get(&quot;id&quot;),kind:&quot;1&quot;},&quot;begin&quot;);</ClientEvent>
            <Property name="caption">新增</Property>
            <Property name="icon">url(>skin>common/icons.gif) -120px -0px</Property>
          </ToolBarButton>
          <ToolBarButton>
            <ClientEvent name="onClick">var record = view.id(&quot;dsSmDeptAutRange&quot;).getData(&quot;#&quot;);&#xD;
if(!record){&#xD;
    dorado.MessageBox.alert(&quot;请先选中要删除的资源!&quot;);&#xD;
    return;&#xD;
}&#xD;
var id  = record.get(&quot;id&quot;);&#xD;
if(!id){&#xD;
    record.remove();&#xD;
    return;&#xD;
}&#xD;
&#xD;
&#xD;
var ajaxActionRangeDeptDel = view.id(&quot;ajaxActionRangeDeptDel&quot;);&#xD;
ajaxActionRangeDeptDel.set(&quot;parameter&quot;,id).execute(function(){&#xD;
    record.remove();&#xD;
});</ClientEvent>
            <Property name="caption">删除</Property>
            <Property name="icon">url(>skin>common/icons.gif) -140px -0px</Property>
          </ToolBarButton>
        </ToolBar>
        <DataGrid>
          <Property name="dataSet">dsSmDeptAutRange</Property>
          <DataColumn>
            <Property name="name">rangeDeptId</Property>
            <Property name="property">rangeDeptId</Property>
            <Property name="visible">false</Property>
            <Editor/>
          </DataColumn>
          <DataColumn>
            <Property name="caption">权限包含机构</Property>
            <Property name="name">authRangeName</Property>
            <Property name="property">authRangeName</Property>
            <Property name="trigger">triggerRangeDept</Property>
            <Property name="readOnly">false</Property>
            <Editor/>
          </DataColumn>
          <DataColumn>
            <Property name="name">kind</Property>
            <Property name="property">kind</Property>
            <Property name="width">110</Property>
            <Editor/>
          </DataColumn>
        </DataGrid>
        <UpdateAction id="updateActionRangeDept">
          <Property name="dataResolver">smDeptAutRangeCotroller#save</Property>
          <UpdateItem>
            <Property name="dataSet">dsSmDeptAutRange</Property>
          </UpdateItem>
        </UpdateAction>
      </Children>
      <Tools/>
    </Dialog>
    <AjaxAction id="ajaxActionRangeDeptDel">
      <Property name="confirmMessage">确定要删除此记录吗?</Property>
      <Property name="successMessage">删除成功</Property>
      <Property name="service">smDeptAutRangeCotroller#deleteById</Property>
    </AjaxAction>
    <Trigger id="triggerRangeDept">
      <ClientEvent name="onExecute">var record = view.id(&quot;dsSmDeptAutRange&quot;).getData(&quot;#&quot;);&#xD;
&#xD;
var dialog = this.id(&quot;dialogTableSelectDept&quot;);&#xD;
var config = {&#xD;
    caption: &quot;权限机构选择&quot;,&#xD;
    mode: &quot;S&quot;,&#xD;
    onSelect: function(o){&#xD;
		console.log(o);&#xD;
        if(o){&#xD;
			var flag = true;&#xD;
			var entityList = view.id(&quot;dsSmDeptAutRange&quot;).getData();&#xD;
			entityList.each(function(item){&#xD;
				var rangeDeptId = item.get(&quot;rangeDeptId&quot;);&#xD;
				if(rangeDeptId ==  o.get(&quot;id&quot;)){&#xD;
					flag = false;&#xD;
					dorado.MessageBox.alert(&quot;选择的权限机构已经存在,不能重复选择权限机构&quot;);					&#xD;
				}&#xD;
			});&#xD;
			if(flag){&#xD;
				var name = [];&#xD;
				var deptList =o.get(&quot;parents&quot;);&#xD;
                if (deptList) {&#xD;
	                  deptList.each(function(item){&#xD;
					  	console.log(&quot;item---->&quot;,item);&#xD;
		                 name.push(item.get(&quot;name&quot;));&#xD;
	                  });&#xD;
                }  &#xD;
				record.set(&quot;authRangeName&quot;,name.join(&quot;->&quot;));&#xD;
				record.set(&quot;rangeDeptId&quot;,o.get(&quot;id&quot;));&#xD;
			}&#xD;
            &#xD;
        }       &#xD;
    }&#xD;
}&#xD;
dialog.show(config);</ClientEvent>
    </Trigger>
    <Dialog id="dialogTableSelectDept">
      <ClientEvent name="onReady">self.setBack = function(o){&#xD;
	if( o ){&#xD;
		var cb = this.$$callback;&#xD;
        if(cb){&#xD;
			cb(o);  &#xD;
		}&#xD;
	}&#xD;
}&#xD;
self._$doShow = self.doShow;&#xD;
self.doShow = function(p)&#xD;
{&#xD;
	if(!p.oParam)&#xD;
	   p.oParam = p;&#xD;
	this._$oParam = p.oParam;&#xD;
	var o = this._$oParam;&#xD;
	if(o.caption){&#xD;
        self.set(&quot;width&quot;,o.caption);&#xD;
    }&#xD;
	if(o.width){&#xD;
		self.set(&quot;width&quot;,o.width);&#xD;
	}&#xD;
	if(o.height){&#xD;
		self.set(&quot;height&quot;,o.height);&#xD;
	}&#xD;
	var mode = o[&quot;mode&quot;];&#xD;
	mode = mode ? mode : &quot;S&quot;;&#xD;
    if(mode=='S'){&#xD;
		view.id(&quot;dataGridSelectDept&quot;).set(&quot;selectionMode&quot;,'singleRow');&#xD;
	}else{&#xD;
		view.id(&quot;dataGridSelectDept&quot;).set(&quot;selectionMode&quot;,'multiRows');		&#xD;
	}&#xD;
	var orgkind = o.orgkind;&#xD;
	&#xD;
	&#xD;
	var dataset =  view.id(&quot;dataSetSelectDept&quot;);&#xD;
	console.log(&quot;o------->&quot;,o);&#xD;
	//o.appParam = {}&#xD;
	if(o.appParam){		&#xD;
		dataset.set(&quot;parameter&quot;,o.appParam);&#xD;
	}&#xD;
    dataset.flushAsync();&#xD;
	this.$$callback = o[&quot;onSelect&quot;];&#xD;
	this._$doShow(p);	&#xD;
};&#xD;
&#xD;
</ClientEvent>
      <Property name="center">true</Property>
      <Property name="height">400</Property>
      <Property name="modal">true</Property>
      <Property name="width">600</Property>
      <Property name="caption">机构选择</Property>
      <Buttons>
        <Button id="btnSelDeptOk">
          <ClientEvent name="onClick">var dialog=this.id(&quot;dialogTableSelectDept&quot;);&#xD;
var dataTable = this.id(&quot;dataGridSelectDept&quot;);&#xD;
var datas = dataTable.get(&quot;selection&quot;);	&#xD;
 &#xD;
if(!datas){&#xD;
	dorado.MessageBox.alert(&quot;请选择机构！&quot;);&#xD;
}else{&#xD;
	dialog.setBack(datas);&#xD;
	dialog.hide();&#xD;
}</ClientEvent>
          <Property name="caption">确定</Property>
          <Property name="icon">url(skin>common/icons.gif) -140px -20px</Property>
        </Button>
        <Button id="buttonDeptClose">
          <ClientEvent name="onClick">var dialog = this.id(&quot;dialogTableSelectDept&quot;);&#xD;
dialog.hide();</ClientEvent>
          <Property name="caption">取消</Property>
          <Property name="icon">url(skin>common/icons.gif) -40px 0px</Property>
        </Button>
      </Buttons>
      <Children>
        <DataSet id="dataSetSelectDept">
          <Property name="dataType">[dtDept2]</Property>
          <Property name="dataProvider">smDeptCotroller#queryResult</Property>
          <Property name="pageSize">15</Property>
          <Property name="loadMode">manual</Property>
        </DataSet>
        <DataPilot>
          <Property name="dataSet">dataSetSelectDept</Property>
        </DataPilot>
        <DataGrid id="dataGridSelectDept">
          <ClientEvent name="onDataRowDoubleClick">/*&#xD;
var entity=this.id(&quot;dataSetSelectDept&quot;).getData(&quot;#&quot;); //取得原始数据列表&#xD;
var selectedItems=this.id(&quot;dataGridSelectDept&quot;).get(&quot;selection&quot;); //定义一个数组&#xD;
if(this.id(&quot;dataGridSelectDept&quot;).get(&quot;selectionMode&quot;)==&quot;singleRow&quot;){&#xD;
	if(!selectedItems)&#xD;
	  selectedItems = entity;&#xD;
    else&#xD;
      selectedItems = null;&#xD;
}else{&#xD;
	var find = false;&#xD;
	selectedItems.each(function(item){&#xD;
		if(item.get(&quot;id&quot;)==entity.get(&quot;id&quot;))&#xD;
		   find=true;&#xD;
	});&#xD;
	if(!find)&#xD;
	  selectedItems.push(entity);&#xD;
	else&#xD;
	  selectedItems.remove(entity);&#xD;
}&#xD;
this.id(&quot;dataGridSelectDept&quot;).set(&quot;selection&quot;,selectedItems);&#xD;
*/&#xD;
</ClientEvent>
          <Property name="dataSet">dataSetSelectDept</Property>
          <Property name="readOnly">true</Property>
          <Property name="selectionMode">multiRows</Property>
          <Property name="showFilterBar">true</Property>
          <Property name="filterMode">serverSide</Property>
          <RowSelectorColumn id="rowSelectorColumn"/>
          <DataColumn>
            <ClientEvent name="onRenderCell">var entitylist = arg.data.get(&quot;parents&quot;);&#xD;
var name = [];&#xD;
if (entitylist) {&#xD;
	entitylist.each(function(item){&#xD;
		name.push(item.get(&quot;name&quot;));&#xD;
	});&#xD;
}&#xD;
var fullName= name.join(&quot; -> &quot;); &#xD;
arg.dom.innerHTML =fullName;&#xD;
</ClientEvent>
            <Property name="name">name</Property>
            <Property name="property">name</Property>
            <Property name="caption">名称</Property>
          </DataColumn>
        </DataGrid>
      </Children>
    </Dialog>
    <Dialog id="dialogPepdom">
      <Property name="caption">用户权限</Property>
      <Property name="height">600</Property>
      <Property name="width">350</Property>
      <Buttons/>
      <Children>
        <ListBox id="listPepdom"/>
      </Children>
      <Tools/>
    </Dialog>
  </View>
</ViewConfig>
